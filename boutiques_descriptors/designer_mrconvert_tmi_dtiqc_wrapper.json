{
    "name": "designer_mrconvert_tmi_dtiqc_wrapper",
    "description": "Designer2 is a denoising and model fitting pipeline for multishell data",
    "tool-version": "v2.0.13",
    "schema-version": "0.5",
    "url":"https://nyu-diffusionmri.github.io/DESIGNER-v2/",
    "command-line": "python -u /wrapper/designer_mrconvert_tmi_dtiqc_wrapper.py <designer_bids_input FILE> <designer_output STRING> <mrtrix_BZeroThreshold NUMBER> --designer_bids_subject <designer_bids_input FILE> <--designer_ses_pattern STRING> <--designer_file_pattern STRING> <--designer_eddy FLAG> <--designer_denoise FLAG> <--designer_shrinkage STRING> <--designer_algorithm STRING> <--designer_degibbs FLAG> <--designer_pf NUMBER> <--designer_pe_dir STRING>  <--designer_b1correct FLAG> <--designer_normalize FLAG> <--designer_scratch STRING> <--designer_nocleanup FLAG> <--mrconvert_fslgrad FLAG> <--tmi_DKI FLAG> <--tmi_DTI FLAG> <--tmi_nocleanup FLAG>",
    "container-image": {
        "image": "designer_mrconvert_tmi_wrapper.sif",
        "type": "singularity"
    },
    "inputs": [
    {
        "name": "Mtrix B0 Threshold",
        "command-line-flag": "--mrtrix_BZeroThreshold",
        "value-key": "<mrtrix_BZeroThreshold NUMBER>",
        "type": "Number",
        "id": "mrtrix_BZeroThreshold",
        "description": "Threshold for B0 images in mrtrix dwiextract",
        "default-value": 61,
        "optional": false
    },
    {
            "name": "BIDS dataset",
            "value-key": "<designer_bids_input FILE>",
            "type": "File",
            "id": "designer_bids_input",
            "list": false,
            "description": "BIDS dataset input file",
            "optional": false
        },
        {
            "name": "Output directory name",
            "value-key": "<designer_output STRING>",
            "type": "String",
            "id": "designer_output",
            "description": "Output directory name",
            "default-value": "designer_output",
            "optional": false
        },
        {
            "name": "Session encoding pattern",
            "command-line-flag": "--designer_ses_pattern",
            "value-key": "<--designer_ses_pattern STRING>",
            "type": "String",
            "list-separator": ",",
            "id": "designer_ses_pattern",
            "description": "Pattern to use in order to select sessions for denoising",
            "list": true,
            "optional": true
        },
        {
            "name": "Phase encoding pattern",
            "command-line-flag": "--designer_file_pattern",
            "value-key": "<--designer_file_pattern STRING>",
            "type": "String",
            "id": "designer_file_pattern",
            "list-separator": ",",
            "description": "Pattern to use in order to select phase files for denoising",
            "list": true,
            "optional": false
        },
        {
            "name": "Run fsl eddy",
            "command-line-flag": "--designer_eddy",
            "value-key": "<--designer_eddy FLAG>",
            "type": "Flag",
            "id": "designer_eddy",
            "description": "Run fsl eddy",
            "optional": true,
            "default-value": true,
            "requires-inputs": ["designer_pe_dir"]
        },
        {
            "name": "Perform MPPCA",
            "command-line-flag": "--designer_denoise",
            "value-key": "<--designer_denoise FLAG>",
            "type": "Flag",
            "id": "designer_denoise",
            "description": "Perform MPPCA denoising",
            "default-value": true,
            "optional": true
        },
        {
            "name": "Shrinkage method",
            "command-line-flag": "--designer_shrinkage",
            "value-key": "<--designer_shrinkage STRING>",
            "type": "String",
            "id": "designer_shrinkage",
            "description": "Specify shrinkage type for MPPCA",
            "value-choices": ["threshold", "frob"],
            "default-value": "frob",
            "optional": true
        },
        {
            "name": "Algorithm",
            "command-line-flag": "--designer_algorithm",
            "value-key": "<--designer_algorithm STRING>",
            "type": "String",
            "id": "designer_algorithm",
            "description": "Specify MP algorithm",
            "value-choices": ["veraart", "(cordero-grande)", "jespersen"],
            "default-value": "jespersen",
            "optional": true
        },
        {
            "name": "Perform Gibbs artifact correction",
            "command-line-flag": "--designer_degibbs",
            "value-key": "<--designer_degibbs FLAG>",
            "type": "Flag",
            "id": "designer_degibbs",
            "description": "Perform Gibbs artifact correction",
            "default-value": true,
            "optional": true
        },
        {
            "name": "Bias correction",
            "command-line-flag": "--designer_b1correct",
            "value-key": "<--designer_b1correct FLAG>",
            "type": "Flag",
            "id": "designer_b1correct",
            "description": "Perform B1 bias field correction",
            "default-value": true,
            "optional": true
        },
        {
            "name": "Normalize dwi volumes",
            "command-line-flag": "--designer_normalize",
            "value-key": "<--designer_normalize FLAG>",
            "type": "Flag",
            "id": "designer_normalize",
            "description": "Normalize dwi volumes",
            "default-value": true,
            "optional": true
        },
        {
            "name": "Scratch directory name",
            "command-line-flag": "--designer_scratch",
            "value-key": "<--designer_scratch STRING>",
            "type": "String",
            "id": "designer_scratch",
            "description": "Scratch directory name",
            "default-value": "designer_scratch",
            "optional": true
        },
        {
            "name": "Phase enconding direction",
            "command-line-flag": "--designer_pe_dir",
            "value-key": "<--designer_pe_dir STRING>",
            "type": "String",
            "id": "designer_pe_dir",
            "description": "Phase encoding direction",
            "value-choices": ["j-","j","i-","i","k-","k"],
            "default-value": "j-",
            "optional": true
        },
        {
            "name": "Partial Fourier factor",
            "command-line-flag": "--designer_pf",
            "value-key": "<--designer_pf NUMBER>",
            "type": "Number",
            "id": "designer_pf",
            "description": "Specify the partial fourier factor (e.g. 7/8, 6/8)",
            "default-value": "0.75"
        },
        {
            "name": "No cleanup",
            "command-line-flag": "--designer_nocleanup",
            "value-key": "<--designer_nocleanup FLAG>",
            "type": "Flag",
            "id": "designer_nocleanup",
            "description": "Do not delete intermediate files",
            "optional": true,
            "default-value": true
        },
        {
            "name": "Provide the diffusion-weighted gradient",
            "command-line-flag": "--mrconvert_fslgrad",
            "value-key": "<--mrconvert_fslgrad FLAG>",
            "type": "Flag",
            "id": "mrconvert_fslgrad",
            "description": "Provide the diffusion-weighted gradient scheme used in the acquisition in FSL bvecs/bval",
            "default-value": true,
            "optional": true
        },
        {
            "name": "Include DKI parameters",
            "command-line-flag": "--tmi_DKI",
            "value-key": "<--tmi_DKI FLAG>",
            "type": "Flag",
            "id": "tmi_DKI",
            "description": "Include DKI parameters",
            "default-value": true,
            "optional": true
        },
        {
            "name": "Include DTI parameters",
            "command-line-flag": "--tmi_DTI",
            "value-key": "<--tmi_DTI FLAG>",
            "type": "Flag",
            "id": "tmi_DTI",
            "description": "Include DTI parameters in output folder (md,ad,rd,fa,eigenvalues,eigenvectors)",
            "default-value": true,
            "optional": true
        },
        {
            "name": "tmi nocleanup",
            "command-line-flag": "--tmi_nocleanup",
            "value-key": "<--tmi_nocleanup FLAG>",
            "type": "Flag",
            "id": "tmi_nocleanup",
            "description": "Do not delete intermediate files during script execution, and do not delete scratch directory at script completion",
            "default-value": true,
            "optional": true
        }
    ],
    "output-files": [
        {
            "name": "Output Merged Denoised DWI files",
            "id": "designer_output_dir",
            "description": "Directory output",
            "path-template": "<designer_output STRING>",
            "optional": false
       },
       {
            "name": "Scratch directory",
            "id": "designer_scratch_dir",
            "description": "Scratch directory output",
            "path-template": "<--designer_scratch STRING>",
            "optional": true
       }
    ],
    "tags": {
        "domain": "boutiques"
    },
    "suggested-resources": {
        "cpu-cores": 8,
        "ram": 8,
        "walltime-estimate": 360
    },
    "error-codes": [
        {
            "code": 1,
            "description": "Crashed"
        }
    ],
    "groups": [
        {
            "id": "mtrix_conf",
            "name": "Mrtrix - Options",
            "description": "Options for mrtrix",
            "members": [
                "mrtrix_BZeroThreshold"
            ]
        },
        {
            "id": "designer_mandatory_options",
            "name": "Designer - Inputs/Outputs Options",
            "description": "Designer - Inputs/Outputs Options",
            "members": [
                "designer_bids_input",
                "designer_ses_pattern",
                "designer_file_pattern"
            ]
        },
        {
            "id": "designer_group_eddy",
            "name": "Designer - Eddy Options",
            "description": "Options related to Eddy Correction",
            "members": [
                "designer_eddy"
            ]
        },
        {
            "id": "designer_group_denoise",
            "name": "Designer - Denoising parameters",
            "description": "Options for specifying denoising parameters",
            "members": [
                "designer_denoise",
                "designer_shrinkage",
                "designer_algorithm"
            ]
        },
        {
            "id": "designer_other_options",
            "name": "Designer - Other Options",
            "description": "Options options for the DESIGNER script",
            "members": [
                "designer_degibbs",
                "designer_b1correct",
                "designer_normalize",
                "designer_scratch",
                "designer_pe_dir",
                "designer_pf"
            ]
        },
        {
            "id": "designer_additional_options",
            "name": "Designer - Additional Options",
            "description": "Additional options for the DESIGNER script",
            "members": [
                "designer_nocleanup"
            ]
        },
        {
            "id": "mrconvert_options",
            "name": "mrconvert - Options",
            "description": "mrconvert options",
            "members": [
                "mrconvert_fslgrad"
            ]
        },
        {
            "id": "tmi_option",
            "name": "tmi - Options",
            "description": "tmi options",
            "members": [
                "tmi_DTI",
                "tmi_DKI",
                "tmi_nocleanup"
            ]
        }
    ],
    "custom": {
        "cbrain:author": "Alexandre Pastor-Bernier <alexandre.pastor@mcgill.ca> and Natacha Beck <nbeck@mcin.ca>",
        "cbrain:plugins-container-bindmount": "/wrapper",
        "cbrain:readonly-input-files": true,
        "cbrain:integrator_modules": {
            "BoutiquesFileTypeVerifier": {
                "designer_bids_input": [
                    "BidsSubject"
                ]
            },
            "BoutiquesFileNameMatcher": {
                "designer_bids_input": "^sub-[a-zA-Z0-9_]+$"
            },
            "BoutiquesBidsSingleSubjectMaker": "designer_bids_input",
            "BoutiquesOutputFileTypeSetter": {
                "designer_output": "DmtOutput"
            }
        }
    }
}

